language: objective-c

env:
    global:
        - EnableNuGetPackageRestore=true
    matrix:
        - MONO_VER="3.0.12"

branches:
    only:
        - dev

before_script: |
    - wget "http://download.mono-project.com/archive/${MONO_VER}/macos-10-x86/MonoFramework-MDK-${MONO_VER}.macos10.xamarin.x86.dmg"
    - hdid "MonoFramework-MDK-${MONO_VER}.macos10.xamarin.x86.dmg"
    - sudo installer -pkg "/Volumes/Mono Framework MDK ${MONO_VER}/MonoFramework-MDK-${MONO_VER}.macos10.xamarin.x86.pkg" -target /
    - git clone https://github.com/junegunn/vader.vim.git
    - xbuild server/PoshComplete/PoshComplete.csproj.ubuntu
    - mono server/PoshComplete/bin/Debug/PoshComplete.exe 

script: |
    - vim -Nu <(cat << VIMRC
    - set rtp+=vader.vim
    - set rtp+=.
    - VIMRC) -c 'Vader! test/*' > /dev/null

after_script: |
    - curl http://localhost:1234/stop

